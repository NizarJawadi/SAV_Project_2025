# √âtape de build avec OpenJDK 17 et installation de Maven
FROM openjdk:17-slim AS build

# Installer Maven
RUN apt-get update && apt-get install -y maven

# Dossier de travail dans le conteneur
WORKDIR /app

# Copier le fichier pom.xml et t√©l√©charger les d√©pendances Maven
COPY pom.xml .

# T√©l√©charger les d√©pendances Maven
RUN mvn dependency:go-offline

# Copier tout le code source
COPY src ./src

# Compiler le projet et cr√©er le fichier JAR
RUN mvn clean install -DskipTests

# √âtape d'ex√©cution avec une image plus l√©g√®re
FROM eclipse-temurin:17-jdk-alpine

# Dossier de travail dans le conteneur
WORKDIR /app

# Copier le JAR depuis l'√©tape de build
COPY --from=build /app/target/*.jar app.jar

# üî• D√©finir le profil actif pour Spring Boot
ENV SPRING_PROFILES_ACTIVE=docker

# Exposer le port de l'application
EXPOSE 9090

# D√©marrer l'application
ENTRYPOINT ["java", "-jar", "app.jar"]
